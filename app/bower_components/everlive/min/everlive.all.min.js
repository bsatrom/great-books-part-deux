/*!
  * Reqwest! A general purpose XHR connection manager
  * (c) Dustin Diaz 2013
  * https://github.com/ded/reqwest
  * license MIT
  */
!function(e,t,n){typeof module!="undefined"&&module.exports?module.exports=n():typeof define=="function"&&define.amd?define(n):t[e]=n()}("reqwest",this,function(){function handleReadyState(e,t,n){return function(){if(e._aborted)return n(e.request);e.request&&e.request[readyState]==4&&(e.request.onreadystatechange=noop,twoHundo.test(e.request.status)?t(e.request):n(e.request))}}function setHeaders(e,t){var n=t.headers||{},r;n.Accept=n.Accept||defaultHeaders.accept[t.type]||defaultHeaders.accept["*"],!t.crossOrigin&&!n[requestedWith]&&(n[requestedWith]=defaultHeaders.requestedWith),n[contentType]||(n[contentType]=t.contentType||defaultHeaders.contentType);for(r in n)n.hasOwnProperty(r)&&e.setRequestHeader(r,n[r])}function setCredentials(e,t){typeof t.withCredentials!="undefined"&&typeof e.withCredentials!="undefined"&&(e.withCredentials=!!t.withCredentials)}function generalCallback(e){lastValue=e}function urlappend(e,t){return e+(/\?/.test(e)?"&":"?")+t}function handleJsonp(e,t,n,r){var i=uniqid++,s=e.jsonpCallback||"callback",o=e.jsonpCallbackName||reqwest.getcallbackPrefix(i),u=new RegExp("((^|\\?|&)"+s+")=([^&]+)"),a=r.match(u),f=doc.createElement("script"),l=0,c=navigator.userAgent.indexOf("MSIE 10.0")!==-1;return a?a[3]==="?"?r=r.replace(u,"$1="+o):o=a[3]:r=urlappend(r,s+"="+o),win[o]=generalCallback,f.type="text/javascript",f.src=r,f.async=!0,typeof f.onreadystatechange!="undefined"&&!c&&(f.event="onclick",f.htmlFor=f.id="_reqwest_"+i),f.onload=f.onreadystatechange=function(){if(f[readyState]&&f[readyState]!=="complete"&&f[readyState]!=="loaded"||l)return!1;f.onload=f.onreadystatechange=null,f.onclick&&f.onclick(),e.success&&e.success(lastValue),lastValue=undefined,head.removeChild(f),l=1},head.appendChild(f),{abort:function(){f.onload=f.onreadystatechange=null,e.error&&e.error({},"Request is aborted: timeout",{}),lastValue=undefined,head.removeChild(f),l=1}}}function getRequest(e,t){var n=this.o,r=(n.method||"GET").toUpperCase(),i=typeof n=="string"?n:n.url,s=n.processData!==!1&&n.data&&typeof n.data!="string"?reqwest.toQueryString(n.data):n.data||null,o;return(n.type=="jsonp"||r=="GET")&&s&&(i=urlappend(i,s),s=null),n.type=="jsonp"?handleJsonp(n,e,t,i):(o=xhr(),o.open(r,i,!0),setHeaders(o,n),setCredentials(o,n),o.onreadystatechange=handleReadyState(this,e,t),n.before&&n.before(o),o.send(s),o)}function Reqwest(e,t){this.o=e,this.fn=t,init.apply(this,arguments)}function setType(e){var t=e.match(/\.(json|jsonp|html|xml)(\?|$)/);return t?t[1]:"js"}function init(o,fn){function complete(e){o.timeout&&clearTimeout(self.timeout),self.timeout=null;while(self._completeHandlers.length>0)self._completeHandlers.shift()(e)}function success(resp){var filteredResponse=globalSetupOptions.dataFilter(resp.responseText,type),r=resp.responseText=filteredResponse;if(r)switch(type){case"json":try{resp=win.JSON?win.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r;break;case"xml":resp=resp.responseXML&&resp.responseXML.parseError&&resp.responseXML.parseError.errorCode&&resp.responseXML.parseError.reason?null:resp.responseXML}self._responseArgs.resp=resp,self._fulfilled=!0,fn(resp);while(self._fulfillmentHandlers.length>0)self._fulfillmentHandlers.shift()(resp);complete(resp)}function error(e,t,n){self._responseArgs.resp=e,self._responseArgs.msg=t,self._responseArgs.t=n,self._erred=!0;while(self._errorHandlers.length>0)self._errorHandlers.shift()(e,t,n);complete(e)}this.url=typeof o=="string"?o:o.url,this.timeout=null,this._fulfilled=!1,this._fulfillmentHandlers=[],this._errorHandlers=[],this._completeHandlers=[],this._erred=!1,this._responseArgs={};var self=this,type=o.type||setType(this.url);fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){self.abort()},o.timeout)),o.success&&this._fulfillmentHandlers.push(function(){o.success.apply(o,arguments)}),o.error&&this._errorHandlers.push(function(){o.error.apply(o,arguments)}),o.complete&&this._completeHandlers.push(function(){o.complete.apply(o,arguments)}),this.request=getRequest.call(this,success,error)}function reqwest(e,t){return new Reqwest(e,t)}function normalize(e){return e?e.replace(/\r?\n/g,"\r\n"):""}function serial(e,t){var n=e.name,r=e.tagName.toLowerCase(),i=function(e){e&&!e.disabled&&t(n,normalize(e.attributes.value&&e.attributes.value.specified?e.value:e.text))},s,o,u,a;if(e.disabled||!n)return;switch(r){case"input":/reset|button|image|file/i.test(e.type)||(s=/checkbox/i.test(e.type),o=/radio/i.test(e.type),u=e.value,(!s&&!o||e.checked)&&t(n,normalize(s&&u===""?"on":u)));break;case"textarea":t(n,normalize(e.value));break;case"select":if(e.type.toLowerCase()==="select-one")i(e.selectedIndex>=0?e.options[e.selectedIndex]:null);else for(a=0;e.length&&a<e.length;a++)e.options[a].selected&&i(e.options[a])}}function eachFormElement(){var e=this,t,n,r=function(t,n){var r,i,s;for(r=0;r<n.length;r++){s=t[byTag](n[r]);for(i=0;i<s.length;i++)serial(s[i],e)}};for(n=0;n<arguments.length;n++)t=arguments[n],/input|select|textarea/i.test(t.tagName)&&serial(t,e),r(t,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var e={};return eachFormElement.apply(function(t,n){t in e?(e[t]&&!isArray(e[t])&&(e[t]=[e[t]]),e[t].push(n)):e[t]=n},arguments),e}var win=window,doc=document,twoHundo=/^20\d$/,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",head=doc[byTag]("head")[0],uniqid=0,callbackPrefix="reqwest_"+ +(new Date),lastValue,xmlHttpRequest="XMLHttpRequest",noop=function(){},isArray=typeof Array.isArray=="function"?Array.isArray:function(e){return e instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",requestedWith:xmlHttpRequest,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}},xhr=win[xmlHttpRequest]?function(){return new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")},globalSetupOptions={dataFilter:function(e){return e}};return Reqwest.prototype={abort:function(){this._aborted=!0,this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(e,t){return this._fulfilled?e(this._responseArgs.resp):this._erred?t(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(e),this._errorHandlers.push(t)),this},always:function(e){return this._fulfilled||this._erred?e(this._responseArgs.resp):this._completeHandlers.push(e),this},fail:function(e){return this._erred?e(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(e),this}},reqwest.serializeArray=function(){var e=[];return eachFormElement.apply(function(t,n){e.push({name:t,value:n})},arguments),e},reqwest.serialize=function(){if(arguments.length===0)return"";var e,t,n=Array.prototype.slice.call(arguments,0);return e=n.pop(),e&&e.nodeType&&n.push(e)&&(e=null),e&&(e=e.type),e=="map"?t=serializeHash:e=="array"?t=reqwest.serializeArray:t=serializeQueryString,t.apply(null,n)},reqwest.toQueryString=function(e){var t="",n,r=encodeURIComponent,i=function(e,n){t+=r(e)+"="+r(n)+"&"},s,o;if(isArray(e))for(n=0;e&&n<e.length;n++)i(e[n].name,e[n].value);else for(s in e){if(!Object.hasOwnProperty.call(e,s))continue;o=e[s];if(isArray(o))for(n=0;n<o.length;n++)i(s,o[n]);else i(s,e[s])}return t.replace(/&$/,"").replace(/%20/g,"+")},reqwest.getcallbackPrefix=function(){return callbackPrefix},reqwest.compat=function(e,t){return e&&(e.type&&(e.method=e.type)&&delete e.type,e.dataType&&(e.type=e.dataType),e.jsonpCallback&&(e.jsonpCallbackName=e.jsonpCallback)&&delete e.jsonpCallback,e.jsonp&&(e.jsonpCallback=e.jsonp)),new Reqwest(e,t)},reqwest.ajaxSetup=function(e){e=e||{};for(var t in e)globalSetupOptions[t]=e[t]},reqwest});// RSVP.js provides simple tools for organizing asynchronous code.
// https://github.com/tildeio/rsvp.js
// Copyright (c) 2013 Yehuda Katz, Tom Dale, and contributors
(function(){var e,t;(function(){var r={},n={};e=function(e,t,n){r[e]={deps:t,callback:n}};t=function(e){if(n[e]){return n[e]}n[e]={};var i=r[e],o=i.deps,s=i.callback,f=[],c;for(var u=0,a=o.length;u<a;u++){if(o[u]==="exports"){f.push(c={})}else{f.push(t(o[u]))}}var l=s.apply(this,f);return n[e]=c||l}})();e("rsvp/all",["rsvp/defer","exports"],function(e,t){"use strict";var r=e.defer;function n(e){var t=[],n=r(),i=e.length;if(i===0){n.resolve([])}var o=function(e){return function(t){s(e,t)}};var s=function(e,r){t[e]=r;if(--i===0){n.resolve(t)}};var f=function(e){n.reject(e)};for(var c=0;c<e.length;c++){if(e[c]&&typeof e[c].then==="function"){e[c].then(o(c),f)}else{s(c,e[c])}}return n.promise}t.all=n});e("rsvp/async",["exports"],function(e){"use strict";var t=typeof window!=="undefined"?window:{};var r=t.MutationObserver||t.WebKitMutationObserver;var n;if(typeof process!=="undefined"&&{}.toString.call(process)==="[object process]"){n=function(e,t){process.nextTick(function(){e.call(t)})}}else if(r){var i=[];var o=new r(function(){var e=i.slice();i=[];e.forEach(function(e){var t=e[0],r=e[1];t.call(r)})});var s=document.createElement("div");o.observe(s,{attributes:true});window.addEventListener("unload",function(){o.disconnect();o=null});n=function(e,t){i.push([e,t]);s.setAttribute("drainQueue","drainQueue")}}else{n=function(e,t){setTimeout(function(){e.call(t)},1)}}e.async=n});e("rsvp/config",["rsvp/async","exports"],function(e,t){"use strict";var r=e.async;var n={};n.async=r;t.config=n});e("rsvp/defer",["rsvp/promise","exports"],function(e,t){"use strict";var r=e.Promise;function n(){var e={};var t=new r(function(t,r){e.resolve=t;e.reject=r});e.promise=t;return e}t.defer=n});e("rsvp/events",["exports"],function(e){"use strict";var t=function(e,t){this.type=e;for(var r in t){if(!t.hasOwnProperty(r)){continue}this[r]=t[r]}};var r=function(e,t){for(var r=0,n=e.length;r<n;r++){if(e[r][0]===t){return r}}return-1};var n=function(e){var t=e._promiseCallbacks;if(!t){t=e._promiseCallbacks={}}return t};var i={mixin:function(e){e.on=this.on;e.off=this.off;e.trigger=this.trigger;return e},on:function(e,t,i){var o=n(this),s,f;e=e.split(/\s+/);i=i||this;while(f=e.shift()){s=o[f];if(!s){s=o[f]=[]}if(r(s,t)===-1){s.push([t,i])}}},off:function(e,t){var i=n(this),o,s,f;e=e.split(/\s+/);while(s=e.shift()){if(!t){i[s]=[];continue}o=i[s];f=r(o,t);if(f!==-1){o.splice(f,1)}}},trigger:function(e,r){var i=n(this),o,s,f,c,u;if(o=i[e]){for(var a=0;a<o.length;a++){s=o[a];f=s[0];c=s[1];if(typeof r!=="object"){r={detail:r}}u=new t(e,r);f.call(c,u)}}}};e.EventTarget=i});e("rsvp/hash",["rsvp/defer","exports"],function(e,t){"use strict";var r=e.defer;function n(e){var t=0;for(var r in e){t++}return t}function i(e){var t={},i=r(),o=n(e);if(o===0){i.resolve({})}var s=function(e){return function(t){f(e,t)}};var f=function(e,r){t[e]=r;if(--o===0){i.resolve(t)}};var c=function(e){i.reject(e)};for(var u in e){if(e[u]&&typeof e[u].then==="function"){e[u].then(s(u),c)}else{f(u,e[u])}}return i.promise}t.hash=i});e("rsvp/node",["rsvp/promise","rsvp/all","exports"],function(e,t,r){"use strict";var n=e.Promise;var i=t.all;function o(e,t){return function(r,n){if(r){t(r)}else if(arguments.length>2){e(Array.prototype.slice.call(arguments,1))}else{e(n)}}}function s(e){return function(){var t=Array.prototype.slice.call(arguments),r,s;var f=new n(function(e,t){r=e;s=t});i(t).then(function(t){t.push(o(r,s));try{e.apply(this,t)}catch(n){s(n)}});return f}}r.denodeify=s});e("rsvp/promise",["rsvp/config","rsvp/events","exports"],function(e,t,r){"use strict";var n=e.config;var i=t.EventTarget;function o(e){return s(e)||typeof e==="object"&&e!==null}function s(e){return typeof e==="function"}var f=function(e){var t=this,r=false;if(typeof e!=="function"){throw new TypeError("You must pass a resolver function as the sole argument to the promise constructor")}if(!(t instanceof f)){return new f(e)}var n=function(e){if(r){return}r=true;u(t,e)};var i=function(e){if(r){return}r=true;l(t,e)};this.on("promise:resolved",function(e){this.trigger("success",{detail:e.detail})},this);this.on("promise:failed",function(e){this.trigger("error",{detail:e.detail})},this);e(n,i)};var c=function(e,t,r,n){var i=s(r),f,c,a,v;if(i){try{f=r(n.detail);a=true}catch(p){v=true;c=p}}else{f=n.detail;a=true}if(o(f)&&s(f.then)){f.then(function(e){u(t,e)},function(e){l(t,e)})}else if(i&&a){u(t,f)}else if(v){l(t,c)}else if(e==="resolve"){u(t,f)}else if(e==="reject"){l(t,f)}};f.prototype={constructor:f,then:function(e,t){var r=new f(function(){});if(this.isFulfilled){n.async(function(){c("resolve",r,e,{detail:this.fulfillmentValue})},this)}if(this.isRejected){n.async(function(){c("reject",r,t,{detail:this.rejectedReason})},this)}this.on("promise:resolved",function(t){c("resolve",r,e,t)});this.on("promise:failed",function(e){c("reject",r,t,e)});return r}};i.mixin(f.prototype);function u(e,t){if(e===t){a(e,t)}else if(o(t)&&s(t.then)){t.then(function(r){if(t!==r){u(e,r)}else{a(e,r)}},function(t){l(e,t)})}else{a(e,t)}}function a(e,t){n.async(function(){e.trigger("promise:resolved",{detail:t});e.isFulfilled=true;e.fulfillmentValue=t})}function l(e,t){n.async(function(){e.trigger("promise:failed",{detail:t});e.isRejected=true;e.rejectedReason=t})}r.Promise=f});e("rsvp/resolve",["rsvp/promise","exports"],function(e,t){"use strict";var r=e.Promise;function n(e){return typeof e==="function"||typeof e==="object"&&e!==null}function i(e){var t=new r(function(t,r){var i;try{if(n(e)){i=e.then;if(typeof i==="function"){i.call(e,t,r)}else{t(e)}}else{t(e)}}catch(o){r(o)}});return t}t.resolve=i});e("rsvp",["rsvp/events","rsvp/promise","rsvp/node","rsvp/all","rsvp/hash","rsvp/defer","rsvp/config","rsvp/resolve","exports"],function(e,t,r,n,i,o,s,f,c){"use strict";var u=e.EventTarget;var a=t.Promise;var l=r.denodeify;var v=n.all;var p=i.hash;var h=o.defer;var d=s.config;var y=f.resolve;function g(e,t){d[e]=t}c.Promise=a;c.EventTarget=u;c.all=v;c.hash=p;c.defer=h;c.denodeify=l;c.configure=g;c.resolve=y});window.RSVP=t("rsvp")})();
//     Underscore.js 1.4.4
//     http://underscorejs.org
//     (c) 2009-2013 Jeremy Ashkenas, DocumentCloud Inc.
//     Underscore may be freely distributed under the MIT license.
(function(){var n=this,t=n._,r={},e=Array.prototype,u=Object.prototype,i=Function.prototype,a=e.push,o=e.slice,c=e.concat,l=u.toString,f=u.hasOwnProperty,s=e.forEach,p=e.map,h=e.reduce,v=e.reduceRight,d=e.filter,g=e.every,m=e.some,y=e.indexOf,b=e.lastIndexOf,x=Array.isArray,_=Object.keys,j=i.bind,w=function(n){return n instanceof w?n:this instanceof w?(this._wrapped=n,void 0):new w(n)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=w),exports._=w):n._=w,w.VERSION="1.4.4";var A=w.each=w.forEach=function(n,t,e){if(null!=n)if(s&&n.forEach===s)n.forEach(t,e);else if(n.length===+n.length){for(var u=0,i=n.length;i>u;u++)if(t.call(e,n[u],u,n)===r)return}else for(var a in n)if(w.has(n,a)&&t.call(e,n[a],a,n)===r)return};w.map=w.collect=function(n,t,r){var e=[];return null==n?e:p&&n.map===p?n.map(t,r):(A(n,function(n,u,i){e[e.length]=t.call(r,n,u,i)}),e)};var O="Reduce of empty array with no initial value";w.reduce=w.foldl=w.inject=function(n,t,r,e){var u=arguments.length>2;if(null==n&&(n=[]),h&&n.reduce===h)return e&&(t=w.bind(t,e)),u?n.reduce(t,r):n.reduce(t);if(A(n,function(n,i,a){u?r=t.call(e,r,n,i,a):(r=n,u=!0)}),!u)throw new TypeError(O);return r},w.reduceRight=w.foldr=function(n,t,r,e){var u=arguments.length>2;if(null==n&&(n=[]),v&&n.reduceRight===v)return e&&(t=w.bind(t,e)),u?n.reduceRight(t,r):n.reduceRight(t);var i=n.length;if(i!==+i){var a=w.keys(n);i=a.length}if(A(n,function(o,c,l){c=a?a[--i]:--i,u?r=t.call(e,r,n[c],c,l):(r=n[c],u=!0)}),!u)throw new TypeError(O);return r},w.find=w.detect=function(n,t,r){var e;return E(n,function(n,u,i){return t.call(r,n,u,i)?(e=n,!0):void 0}),e},w.filter=w.select=function(n,t,r){var e=[];return null==n?e:d&&n.filter===d?n.filter(t,r):(A(n,function(n,u,i){t.call(r,n,u,i)&&(e[e.length]=n)}),e)},w.reject=function(n,t,r){return w.filter(n,function(n,e,u){return!t.call(r,n,e,u)},r)},w.every=w.all=function(n,t,e){t||(t=w.identity);var u=!0;return null==n?u:g&&n.every===g?n.every(t,e):(A(n,function(n,i,a){return(u=u&&t.call(e,n,i,a))?void 0:r}),!!u)};var E=w.some=w.any=function(n,t,e){t||(t=w.identity);var u=!1;return null==n?u:m&&n.some===m?n.some(t,e):(A(n,function(n,i,a){return u||(u=t.call(e,n,i,a))?r:void 0}),!!u)};w.contains=w.include=function(n,t){return null==n?!1:y&&n.indexOf===y?n.indexOf(t)!=-1:E(n,function(n){return n===t})},w.invoke=function(n,t){var r=o.call(arguments,2),e=w.isFunction(t);return w.map(n,function(n){return(e?t:n[t]).apply(n,r)})},w.pluck=function(n,t){return w.map(n,function(n){return n[t]})},w.where=function(n,t,r){return w.isEmpty(t)?r?null:[]:w[r?"find":"filter"](n,function(n){for(var r in t)if(t[r]!==n[r])return!1;return!0})},w.findWhere=function(n,t){return w.where(n,t,!0)},w.max=function(n,t,r){if(!t&&w.isArray(n)&&n[0]===+n[0]&&65535>n.length)return Math.max.apply(Math,n);if(!t&&w.isEmpty(n))return-1/0;var e={computed:-1/0,value:-1/0};return A(n,function(n,u,i){var a=t?t.call(r,n,u,i):n;a>=e.computed&&(e={value:n,computed:a})}),e.value},w.min=function(n,t,r){if(!t&&w.isArray(n)&&n[0]===+n[0]&&65535>n.length)return Math.min.apply(Math,n);if(!t&&w.isEmpty(n))return 1/0;var e={computed:1/0,value:1/0};return A(n,function(n,u,i){var a=t?t.call(r,n,u,i):n;e.computed>a&&(e={value:n,computed:a})}),e.value},w.shuffle=function(n){var t,r=0,e=[];return A(n,function(n){t=w.random(r++),e[r-1]=e[t],e[t]=n}),e};var k=function(n){return w.isFunction(n)?n:function(t){return t[n]}};w.sortBy=function(n,t,r){var e=k(t);return w.pluck(w.map(n,function(n,t,u){return{value:n,index:t,criteria:e.call(r,n,t,u)}}).sort(function(n,t){var r=n.criteria,e=t.criteria;if(r!==e){if(r>e||r===void 0)return 1;if(e>r||e===void 0)return-1}return n.index<t.index?-1:1}),"value")};var F=function(n,t,r,e){var u={},i=k(t||w.identity);return A(n,function(t,a){var o=i.call(r,t,a,n);e(u,o,t)}),u};w.groupBy=function(n,t,r){return F(n,t,r,function(n,t,r){(w.has(n,t)?n[t]:n[t]=[]).push(r)})},w.countBy=function(n,t,r){return F(n,t,r,function(n,t){w.has(n,t)||(n[t]=0),n[t]++})},w.sortedIndex=function(n,t,r,e){r=null==r?w.identity:k(r);for(var u=r.call(e,t),i=0,a=n.length;a>i;){var o=i+a>>>1;u>r.call(e,n[o])?i=o+1:a=o}return i},w.toArray=function(n){return n?w.isArray(n)?o.call(n):n.length===+n.length?w.map(n,w.identity):w.values(n):[]},w.size=function(n){return null==n?0:n.length===+n.length?n.length:w.keys(n).length},w.first=w.head=w.take=function(n,t,r){return null==n?void 0:null==t||r?n[0]:o.call(n,0,t)},w.initial=function(n,t,r){return o.call(n,0,n.length-(null==t||r?1:t))},w.last=function(n,t,r){return null==n?void 0:null==t||r?n[n.length-1]:o.call(n,Math.max(n.length-t,0))},w.rest=w.tail=w.drop=function(n,t,r){return o.call(n,null==t||r?1:t)},w.compact=function(n){return w.filter(n,w.identity)};var R=function(n,t,r){return A(n,function(n){w.isArray(n)?t?a.apply(r,n):R(n,t,r):r.push(n)}),r};w.flatten=function(n,t){return R(n,t,[])},w.without=function(n){return w.difference(n,o.call(arguments,1))},w.uniq=w.unique=function(n,t,r,e){w.isFunction(t)&&(e=r,r=t,t=!1);var u=r?w.map(n,r,e):n,i=[],a=[];return A(u,function(r,e){(t?e&&a[a.length-1]===r:w.contains(a,r))||(a.push(r),i.push(n[e]))}),i},w.union=function(){return w.uniq(c.apply(e,arguments))},w.intersection=function(n){var t=o.call(arguments,1);return w.filter(w.uniq(n),function(n){return w.every(t,function(t){return w.indexOf(t,n)>=0})})},w.difference=function(n){var t=c.apply(e,o.call(arguments,1));return w.filter(n,function(n){return!w.contains(t,n)})},w.zip=function(){for(var n=o.call(arguments),t=w.max(w.pluck(n,"length")),r=Array(t),e=0;t>e;e++)r[e]=w.pluck(n,""+e);return r},w.object=function(n,t){if(null==n)return{};for(var r={},e=0,u=n.length;u>e;e++)t?r[n[e]]=t[e]:r[n[e][0]]=n[e][1];return r},w.indexOf=function(n,t,r){if(null==n)return-1;var e=0,u=n.length;if(r){if("number"!=typeof r)return e=w.sortedIndex(n,t),n[e]===t?e:-1;e=0>r?Math.max(0,u+r):r}if(y&&n.indexOf===y)return n.indexOf(t,r);for(;u>e;e++)if(n[e]===t)return e;return-1},w.lastIndexOf=function(n,t,r){if(null==n)return-1;var e=null!=r;if(b&&n.lastIndexOf===b)return e?n.lastIndexOf(t,r):n.lastIndexOf(t);for(var u=e?r:n.length;u--;)if(n[u]===t)return u;return-1},w.range=function(n,t,r){1>=arguments.length&&(t=n||0,n=0),r=arguments[2]||1;for(var e=Math.max(Math.ceil((t-n)/r),0),u=0,i=Array(e);e>u;)i[u++]=n,n+=r;return i},w.bind=function(n,t){if(n.bind===j&&j)return j.apply(n,o.call(arguments,1));var r=o.call(arguments,2);return function(){return n.apply(t,r.concat(o.call(arguments)))}},w.partial=function(n){var t=o.call(arguments,1);return function(){return n.apply(this,t.concat(o.call(arguments)))}},w.bindAll=function(n){var t=o.call(arguments,1);return 0===t.length&&(t=w.functions(n)),A(t,function(t){n[t]=w.bind(n[t],n)}),n},w.memoize=function(n,t){var r={};return t||(t=w.identity),function(){var e=t.apply(this,arguments);return w.has(r,e)?r[e]:r[e]=n.apply(this,arguments)}},w.delay=function(n,t){var r=o.call(arguments,2);return setTimeout(function(){return n.apply(null,r)},t)},w.defer=function(n){return w.delay.apply(w,[n,1].concat(o.call(arguments,1)))},w.throttle=function(n,t){var r,e,u,i,a=0,o=function(){a=new Date,u=null,i=n.apply(r,e)};return function(){var c=new Date,l=t-(c-a);return r=this,e=arguments,0>=l?(clearTimeout(u),u=null,a=c,i=n.apply(r,e)):u||(u=setTimeout(o,l)),i}},w.debounce=function(n,t,r){var e,u;return function(){var i=this,a=arguments,o=function(){e=null,r||(u=n.apply(i,a))},c=r&&!e;return clearTimeout(e),e=setTimeout(o,t),c&&(u=n.apply(i,a)),u}},w.once=function(n){var t,r=!1;return function(){return r?t:(r=!0,t=n.apply(this,arguments),n=null,t)}},w.wrap=function(n,t){return function(){var r=[n];return a.apply(r,arguments),t.apply(this,r)}},w.compose=function(){var n=arguments;return function(){for(var t=arguments,r=n.length-1;r>=0;r--)t=[n[r].apply(this,t)];return t[0]}},w.after=function(n,t){return 0>=n?t():function(){return 1>--n?t.apply(this,arguments):void 0}},w.keys=_||function(n){if(n!==Object(n))throw new TypeError("Invalid object");var t=[];for(var r in n)w.has(n,r)&&(t[t.length]=r);return t},w.values=function(n){var t=[];for(var r in n)w.has(n,r)&&t.push(n[r]);return t},w.pairs=function(n){var t=[];for(var r in n)w.has(n,r)&&t.push([r,n[r]]);return t},w.invert=function(n){var t={};for(var r in n)w.has(n,r)&&(t[n[r]]=r);return t},w.functions=w.methods=function(n){var t=[];for(var r in n)w.isFunction(n[r])&&t.push(r);return t.sort()},w.extend=function(n){return A(o.call(arguments,1),function(t){if(t)for(var r in t)n[r]=t[r]}),n},w.pick=function(n){var t={},r=c.apply(e,o.call(arguments,1));return A(r,function(r){r in n&&(t[r]=n[r])}),t},w.omit=function(n){var t={},r=c.apply(e,o.call(arguments,1));for(var u in n)w.contains(r,u)||(t[u]=n[u]);return t},w.defaults=function(n){return A(o.call(arguments,1),function(t){if(t)for(var r in t)null==n[r]&&(n[r]=t[r])}),n},w.clone=function(n){return w.isObject(n)?w.isArray(n)?n.slice():w.extend({},n):n},w.tap=function(n,t){return t(n),n};var I=function(n,t,r,e){if(n===t)return 0!==n||1/n==1/t;if(null==n||null==t)return n===t;n instanceof w&&(n=n._wrapped),t instanceof w&&(t=t._wrapped);var u=l.call(n);if(u!=l.call(t))return!1;switch(u){case"[object String]":return n==t+"";case"[object Number]":return n!=+n?t!=+t:0==n?1/n==1/t:n==+t;case"[object Date]":case"[object Boolean]":return+n==+t;case"[object RegExp]":return n.source==t.source&&n.global==t.global&&n.multiline==t.multiline&&n.ignoreCase==t.ignoreCase}if("object"!=typeof n||"object"!=typeof t)return!1;for(var i=r.length;i--;)if(r[i]==n)return e[i]==t;r.push(n),e.push(t);var a=0,o=!0;if("[object Array]"==u){if(a=n.length,o=a==t.length)for(;a--&&(o=I(n[a],t[a],r,e)););}else{var c=n.constructor,f=t.constructor;if(c!==f&&!(w.isFunction(c)&&c instanceof c&&w.isFunction(f)&&f instanceof f))return!1;for(var s in n)if(w.has(n,s)&&(a++,!(o=w.has(t,s)&&I(n[s],t[s],r,e))))break;if(o){for(s in t)if(w.has(t,s)&&!a--)break;o=!a}}return r.pop(),e.pop(),o};w.isEqual=function(n,t){return I(n,t,[],[])},w.isEmpty=function(n){if(null==n)return!0;if(w.isArray(n)||w.isString(n))return 0===n.length;for(var t in n)if(w.has(n,t))return!1;return!0},w.isElement=function(n){return!(!n||1!==n.nodeType)},w.isArray=x||function(n){return"[object Array]"==l.call(n)},w.isObject=function(n){return n===Object(n)},A(["Arguments","Function","String","Number","Date","RegExp"],function(n){w["is"+n]=function(t){return l.call(t)=="[object "+n+"]"}}),w.isArguments(arguments)||(w.isArguments=function(n){return!(!n||!w.has(n,"callee"))}),"function"!=typeof/./&&(w.isFunction=function(n){return"function"==typeof n}),w.isFinite=function(n){return isFinite(n)&&!isNaN(parseFloat(n))},w.isNaN=function(n){return w.isNumber(n)&&n!=+n},w.isBoolean=function(n){return n===!0||n===!1||"[object Boolean]"==l.call(n)},w.isNull=function(n){return null===n},w.isUndefined=function(n){return n===void 0},w.has=function(n,t){return f.call(n,t)},w.noConflict=function(){return n._=t,this},w.identity=function(n){return n},w.times=function(n,t,r){for(var e=Array(n),u=0;n>u;u++)e[u]=t.call(r,u);return e},w.random=function(n,t){return null==t&&(t=n,n=0),n+Math.floor(Math.random()*(t-n+1))};var M={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};M.unescape=w.invert(M.escape);var S={escape:RegExp("["+w.keys(M.escape).join("")+"]","g"),unescape:RegExp("("+w.keys(M.unescape).join("|")+")","g")};w.each(["escape","unescape"],function(n){w[n]=function(t){return null==t?"":(""+t).replace(S[n],function(t){return M[n][t]})}}),w.result=function(n,t){if(null==n)return null;var r=n[t];return w.isFunction(r)?r.call(n):r},w.mixin=function(n){A(w.functions(n),function(t){var r=w[t]=n[t];w.prototype[t]=function(){var n=[this._wrapped];return a.apply(n,arguments),D.call(this,r.apply(w,n))}})};var N=0;w.uniqueId=function(n){var t=++N+"";return n?n+t:t},w.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var T=/(.)^/,q={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},B=/\\|'|\r|\n|\t|\u2028|\u2029/g;w.template=function(n,t,r){var e;r=w.defaults({},r,w.templateSettings);var u=RegExp([(r.escape||T).source,(r.interpolate||T).source,(r.evaluate||T).source].join("|")+"|$","g"),i=0,a="__p+='";n.replace(u,function(t,r,e,u,o){return a+=n.slice(i,o).replace(B,function(n){return"\\"+q[n]}),r&&(a+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'"),e&&(a+="'+\n((__t=("+e+"))==null?'':__t)+\n'"),u&&(a+="';\n"+u+"\n__p+='"),i=o+t.length,t}),a+="';\n",r.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{e=Function(r.variable||"obj","_",a)}catch(o){throw o.source=a,o}if(t)return e(t,w);var c=function(n){return e.call(this,n,w)};return c.source="function("+(r.variable||"obj")+"){\n"+a+"}",c},w.chain=function(n){return w(n).chain()};var D=function(n){return this._chain?w(n).chain():n};w.mixin(w),A(["pop","push","reverse","shift","sort","splice","unshift"],function(n){var t=e[n];w.prototype[n]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!=n&&"splice"!=n||0!==r.length||delete r[0],D.call(this,r)}}),A(["concat","join","slice"],function(n){var t=e[n];w.prototype[n]=function(){return D.call(this,t.apply(this._wrapped,arguments))}}),w.extend(w.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this);/*! jsTimezoneDetect - v1.0.5 - 2013-04-01 */
(function(e){var t=function(){"use strict";var e="s",n=2011,r=function(e){var t=-e.getTimezoneOffset();return t!==null?t:0},i=function(e,t,n){var r=new Date;return e!==undefined&&r.setFullYear(e),r.setDate(n),r.setMonth(t),r},s=function(e){return r(i(e,0,2))},o=function(e){return r(i(e,5,2))},u=function(e){var t=e.getMonth()>7?o(e.getFullYear()):s(e.getFullYear()),n=r(e);return t-n!==0},a=function(){var t=s(n),r=o(n),i=t-r;return i<0?t+",1":i>0?r+",1,"+e:t+",0"},f=function(){var e=a();return new t.TimeZone(t.olson.timezones[e])},l=function(e){var t=new Date(2010,6,15,1,0,0,0),n={"America/Denver":new Date(2011,2,13,3,0,0,0),"America/Mazatlan":new Date(2011,3,3,3,0,0,0),"America/Chicago":new Date(2011,2,13,3,0,0,0),"America/Mexico_City":new Date(2011,3,3,3,0,0,0),"America/Asuncion":new Date(2012,9,7,3,0,0,0),"America/Santiago":new Date(2012,9,3,3,0,0,0),"America/Campo_Grande":new Date(2012,9,21,5,0,0,0),"America/Montevideo":new Date(2011,9,2,3,0,0,0),"America/Sao_Paulo":new Date(2011,9,16,5,0,0,0),"America/Los_Angeles":new Date(2011,2,13,8,0,0,0),"America/Santa_Isabel":new Date(2011,3,5,8,0,0,0),"America/Havana":new Date(2012,2,10,2,0,0,0),"America/New_York":new Date(2012,2,10,7,0,0,0),"Asia/Beirut":new Date(2011,2,27,1,0,0,0),"Europe/Helsinki":new Date(2011,2,27,4,0,0,0),"Europe/Istanbul":new Date(2011,2,28,5,0,0,0),"Asia/Damascus":new Date(2011,3,1,2,0,0,0),"Asia/Jerusalem":new Date(2011,3,1,6,0,0,0),"Asia/Gaza":new Date(2009,2,28,0,30,0,0),"Africa/Cairo":new Date(2009,3,25,0,30,0,0),"Pacific/Auckland":new Date(2011,8,26,7,0,0,0),"Pacific/Fiji":new Date(2010,10,29,23,0,0,0),"America/Halifax":new Date(2011,2,13,6,0,0,0),"America/Goose_Bay":new Date(2011,2,13,2,1,0,0),"America/Miquelon":new Date(2011,2,13,5,0,0,0),"America/Godthab":new Date(2011,2,27,1,0,0,0),"Europe/Moscow":t,"Asia/Yekaterinburg":t,"Asia/Omsk":t,"Asia/Krasnoyarsk":t,"Asia/Irkutsk":t,"Asia/Yakutsk":t,"Asia/Vladivostok":t,"Asia/Kamchatka":t,"Europe/Minsk":t,"Pacific/Apia":new Date(2010,10,1,1,0,0,0),"Australia/Perth":new Date(2008,10,1,1,0,0,0)};return n[e]};return{determine:f,date_is_dst:u,dst_start_for:l}}();t.TimeZone=function(e){"use strict";var n={"America/Denver":["America/Denver","America/Mazatlan"],"America/Chicago":["America/Chicago","America/Mexico_City"],"America/Santiago":["America/Santiago","America/Asuncion","America/Campo_Grande"],"America/Montevideo":["America/Montevideo","America/Sao_Paulo"],"Asia/Beirut":["Asia/Beirut","Europe/Helsinki","Europe/Istanbul","Asia/Damascus","Asia/Jerusalem","Asia/Gaza"],"Pacific/Auckland":["Pacific/Auckland","Pacific/Fiji"],"America/Los_Angeles":["America/Los_Angeles","America/Santa_Isabel"],"America/New_York":["America/Havana","America/New_York"],"America/Halifax":["America/Goose_Bay","America/Halifax"],"America/Godthab":["America/Miquelon","America/Godthab"],"Asia/Dubai":["Europe/Moscow"],"Asia/Dhaka":["Asia/Yekaterinburg"],"Asia/Jakarta":["Asia/Omsk"],"Asia/Shanghai":["Asia/Krasnoyarsk","Australia/Perth"],"Asia/Tokyo":["Asia/Irkutsk"],"Australia/Brisbane":["Asia/Yakutsk"],"Pacific/Noumea":["Asia/Vladivostok"],"Pacific/Tarawa":["Asia/Kamchatka"],"Pacific/Tongatapu":["Pacific/Apia"],"Africa/Johannesburg":["Asia/Gaza","Africa/Cairo"],"Asia/Baghdad":["Europe/Minsk"]},r=e,i=function(){var e=n[r],i=e.length,s=0,o=e[0];for(;s<i;s+=1){o=e[s];if(t.date_is_dst(t.dst_start_for(o))){r=o;return}}},s=function(){return typeof n[r]!="undefined"};return s()&&i(),{name:function(){return r}}},t.olson={},t.olson.timezones={"-720,0":"Pacific/Majuro","-660,0":"Pacific/Pago_Pago","-600,1":"America/Adak","-600,0":"Pacific/Honolulu","-570,0":"Pacific/Marquesas","-540,0":"Pacific/Gambier","-540,1":"America/Anchorage","-480,1":"America/Los_Angeles","-480,0":"Pacific/Pitcairn","-420,0":"America/Phoenix","-420,1":"America/Denver","-360,0":"America/Guatemala","-360,1":"America/Chicago","-360,1,s":"Pacific/Easter","-300,0":"America/Bogota","-300,1":"America/New_York","-270,0":"America/Caracas","-240,1":"America/Halifax","-240,0":"America/Santo_Domingo","-240,1,s":"America/Santiago","-210,1":"America/St_Johns","-180,1":"America/Godthab","-180,0":"America/Argentina/Buenos_Aires","-180,1,s":"America/Montevideo","-120,0":"America/Noronha","-120,1":"America/Noronha","-60,1":"Atlantic/Azores","-60,0":"Atlantic/Cape_Verde","0,0":"UTC","0,1":"Europe/London","60,1":"Europe/Berlin","60,0":"Africa/Lagos","60,1,s":"Africa/Windhoek","120,1":"Asia/Beirut","120,0":"Africa/Johannesburg","180,0":"Asia/Baghdad","180,1":"Europe/Moscow","210,1":"Asia/Tehran","240,0":"Asia/Dubai","240,1":"Asia/Baku","270,0":"Asia/Kabul","300,1":"Asia/Yekaterinburg","300,0":"Asia/Karachi","330,0":"Asia/Kolkata","345,0":"Asia/Kathmandu","360,0":"Asia/Dhaka","360,1":"Asia/Omsk","390,0":"Asia/Rangoon","420,1":"Asia/Krasnoyarsk","420,0":"Asia/Jakarta","480,0":"Asia/Shanghai","480,1":"Asia/Irkutsk","525,0":"Australia/Eucla","525,1,s":"Australia/Eucla","540,1":"Asia/Yakutsk","540,0":"Asia/Tokyo","570,0":"Australia/Darwin","570,1,s":"Australia/Adelaide","600,0":"Australia/Brisbane","600,1":"Asia/Vladivostok","600,1,s":"Australia/Sydney","630,1,s":"Australia/Lord_Howe","660,1":"Asia/Kamchatka","660,0":"Pacific/Noumea","690,0":"Pacific/Norfolk","720,1,s":"Pacific/Auckland","720,0":"Pacific/Tarawa","765,1,s":"Pacific/Chatham","780,0":"Pacific/Tongatapu","780,1,s":"Pacific/Apia","840,0":"Pacific/Kiritimati"},typeof exports!="undefined"?exports.jstz=t:e.jstz=t})(this);/*!
The MIT License (MIT)

Copyright (c) 2013 Telerik AD

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.y distributed under the MIT license.
*/
/*!
 Everlive SDK
 Version 1.2.7
 */
(function(a,b){if(typeof define==="function"&&define.amd){define(["underscore","rsvp","reqwest","jstz"],function(f,e,c,d){return(a.Everlive=b(f,e,c,d))})}else{if(typeof exports==="object"){module.exports=b(require("underscore"),require("rsvp"))}else{a.Everlive=b(a._,a.RSVP,a.reqwest,a.jstz)}}}(this,function(C,k,m,h){var r=Array.prototype.slice;var F="//api.everlive.com/v1/";var i="Id";function a(I,G,H){if(!H){H="The "+G+" is required"}if(typeof I==="undefined"||I===null){throw new c(H)}}function y(G){this.url=F;this.apiKey=null;this.masterKey=null;this.token=null;this.tokenType=null;this.scheme="http";this._emulatorMode=G.emulatorMode;this.parseOnlyCompleteDateTimeObjects=false;if(typeof G==="string"){this.apiKey=G}else{C.extend(this,G)}}var u=[];function t(H){var G=this;this.setup=new y(H);C.each(u,function(I){I.func.call(G,H)});if(t.$===null){t.$=G}}t.$=null;t.idField=i;t.initializations=u;t.init=function(G){t.$=null;return new t(G)};t.buildUrl=function(G){var H="";if(typeof G.scheme==="string"){H+=G.scheme+":"}H+=G.url;if(G.apiKey){H+=G.apiKey+"/"}return H};t.prototype.data=function(G){return new f(this.setup,G)};t.prototype.buildUrl=function(){return t.buildUrl(this.setup)};var s=function(H,I){var G=null;if(I&&I.authHeaders===false){return G}if(H.token){G=(H.tokenType||"bearer")+" "+H.token}else{if(H.masterKey){G="masterkey "+H.masterKey}}if(G){return{Authorization:G}}else{return null}};t.prototype.buildAuthHeader=function(){return s(this.setup)};(function(){var M={query:1,where:100,filter:101,and:110,or:111,not:112,equal:120,not_equal:121,lt:122,lte:123,gt:124,gte:125,isin:126,notin:127,all:128,size:129,regex:130,contains:131,startsWith:132,endsWith:133,nearShpere:140,withinBox:141,withinPolygon:142,withinShpere:143,select:200,exclude:201,order:300,order_desc:301,skip:400,take:401,expand:402};function I(N,O){this.operator=N;this.operands=O||[]}I.prototype={addOperand:function(N){this.operands.push(N)}};function H(R,N,P,S,O,Q){this.filter=R;this.fields=N;this.sort=P;this.toskip=S;this.totake=O;this.expandExpression=Q;this.expr=new I(M.query)}H.prototype={where:function(N){if(N){return this._simple(M.filter,[N])}else{return new L(this)}},select:function(){return this._simple(M.select,arguments)},order:function(N){return this._simple(M.order,[N])},orderDesc:function(N){return this._simple(M.order_desc,[N])},skip:function(N){return this._simple(M.skip,[N])},take:function(N){return this._simple(M.take,[N])},expand:function(N){return this._simple(M.expand,[N])},build:function(){return new K(this).build()},_simple:function(P,N){var O=r.call(N);this.expr.addOperand(new I(P,O));return this}};function L(P,O,N){this.parent=P;this.single=N;this.expr=new I(O||M.where);this.parent.expr.addOperand(this.expr)}L.prototype={and:function(){return new L(this,M.and)},or:function(){return new L(this,M.or)},not:function(){return new L(this,M.not,true)},_simple:function(N){var O=r.call(arguments,1);this.expr.addOperand(new I(N,O));return this._done()},eq:function(O,N){return this._simple(M.equal,O,N)},ne:function(O,N){return this._simple(M.not_equal,O,N)},gt:function(O,N){return this._simple(M.gt,O,N)},gte:function(O,N){return this._simple(M.gte,O,N)},lt:function(O,N){return this._simple(M.lt,O,N)},lte:function(O,N){return this._simple(M.lte,O,N)},isin:function(O,N){return this._simple(M.isin,O,N)},notin:function(O,N){return this._simple(M.notin,O,N)},all:function(O,N){return this._simple(M.all,O,N)},size:function(O,N){return this._simple(M.size,O,N)},regex:function(P,O,N){return this._simple(M.regex,P,O,N)},startsWith:function(P,O,N){return this._simple(M.startsWith,P,O,N)},endsWith:function(P,O,N){return this._simple(M.endsWith,P,O,N)},nearSphere:function(P,N,Q,O){return this._simple(M.nearShpere,P,N,Q,O)},withinBox:function(O,P,N){return this._simple(M.withinBox,O,P,N)},withinPolygon:function(O,N){return this._simple(M.withinPolygon,O,N)},withinCenterSphere:function(Q,O,N,P){return this._simple(M.withinShpere,Q,O,N,P)},done:function(){if(this.parent instanceof L){return this.parent._done()}else{return this.parent}},_done:function(){if(this.single){return this.parent}else{return this}}};L.prototype.equal=L.prototype.eq;L.prototype.notEqual=L.prototype.ne;L.prototype.greaterThan=L.prototype.gt;L.prototype.greaterThanEqual=L.prototype.gte;L.prototype.lessThan=L.prototype.lt;L.prototype.lessThanEqual=L.prototype.lte;function K(N){this.query=N;this.expr=N.expr}var G={radians:"$maxDistance",km:"$maxDistanceInKilometers",miles:"$maxDistanceInMiles"};var J={radians:"radius",km:"radiusInKilometers",miles:"radiusInMiles"};K.prototype={build:function(){var N=this.query;if(N.filter||N.fields||N.sort||N.toskip||N.totake||N.expandExpression){return{$where:N.filter||null,$select:N.fields||null,$sort:N.sort||null,$skip:N.toskip||null,$take:N.totake||null,$expand:N.expandExpression||null}}return{$where:this._buildWhere(),$select:this._buildSelect(),$sort:this._buildSort(),$skip:this._getSkip(),$take:this._getTake(),$expand:this._getExpand()}},_getSkip:function(){var N=C.find(this.expr.operands,function(Q,O,P){return Q.operator===M.skip});return N?N.operands[0]:null},_getTake:function(){var N=C.find(this.expr.operands,function(Q,O,P){return Q.operator===M.take});return N?N.operands[0]:null},_getExpand:function(){var N=C.find(this.expr.operands,function(Q,O,P){return Q.operator===M.expand});return N?N.operands[0]:null},_buildSelect:function(){var O=C.find(this.expr.operands,function(R,P,Q){return R.operator===M.select});var N={};if(O){C.reduce(O.operands,function(P,Q){P[Q]=1;return P},N);return N}else{return null}},_buildSort:function(){var O=C.filter(this.expr.operands,function(R,P,Q){return R.operator===M.order||R.operator===M.order_desc});var N={};if(O.length>0){C.reduce(O,function(P,Q){P[Q.operands[0]]=Q.operator===M.order?1:-1;return P},N);return N}else{return null}},_buildWhere:function(){var N=C.find(this.expr.operands,function(R,P,Q){return R.operator===M.where});if(N){return this._build(new I(M.and,N.operands))}else{var O=C.find(this.expr.operands,function(R,P,Q){return R.operator===M.filter});if(O){return O.operands[0]}return null}},_build:function(N){if(this._isSimple(N)){return this._simple(N)}else{if(this._isRegex(N)){return this._regex(N)}else{if(this._isGeo(N)){return this._geo(N)}else{if(this._isAnd(N)){return this._and(N)}else{if(this._isOr(N)){return this._or(N)}else{if(this._isNot(N)){return this._not(N)}}}}}}},_isSimple:function(N){return N.operator>=M.equal&&N.operator<=M.size},_simple:function(R){var Q={},N={};var P=R.operands;var O=this._translateoperator(R.operator);if(O){Q[O]=P[1]}else{Q=P[1]}N[P[0]]=Q;return N},_isRegex:function(N){return N.operator>=M.regex&&N.operator<=M.endsWith},_regex:function(R){var N={};var Q=this._getRegex(R);var O=this._getRegexValue(Q);var P=R.operands;N[P[0]]=O;return N},_getRegex:function(P){var O=P.operands[1];var N=P.operands[2]?P.operands[2]:"";switch(P.operator){case M.regex:return O instanceof RegExp?O:new RegExp(O,N);case M.startsWith:return new RegExp("^"+O,N);case M.endsWith:return new RegExp(O+"$",N);default:throw new c("Unknown operator type.")}},_getRegexValue:function(O){var N="";if(O.global){N+="g"}if(O.multiline){N+="m"}if(O.ignoreCase){N+="i"}return{$regex:O.source,$options:N}},_isGeo:function(N){return N.operator>=M.nearShpere&&N.operator<=M.withinShpere},_geo:function(P){var N={};var O=P.operands;N[O[0]]=this._getGeoTerm(P);return N},_getGeoTerm:function(N){switch(N.operator){case M.nearShpere:return this._getNearSphereTerm(N);case M.withinBox:return this._getWithinBox(N);case M.withinPolygon:return this._getWithinPolygon(N);case M.withinShpere:return this._getWithinCenterSphere(N);default:throw new c("Unknown operator type.")}},_getNearSphereTerm:function(T){var P=T.operands;var N=this._getGeoPoint(P[1]);var S=P[2];var R=P[3];var O;var Q={"$nearSphere":N};if(typeof S!=="undefined"){O=G[R]||G.radians;Q[O]=S}return Q},_getWithinBox:function(Q){var O=Q.operands;var N=this._getGeoPoint(O[1]);var P=this._getGeoPoint(O[2]);return{"$within":{"$box":[N,P]}}},_getWithinPolygon:function(P){var N=P.operands;var O=this._getGeoPoints(N[1]);return{"$within":{"$polygon":O}}},_getWithinCenterSphere:function(T){var R=T.operands;var O=this._getGeoPoint(R[1]);var N=R[2];var S=R[3];var P=J[S]||J.radians;var Q={center:O};Q[P]=N;return{"$within":{"$centerSphere":Q}}},_getGeoPoint:function(N){if(C.isArray(N)){return new n(N[0],N[1])}return N},_getGeoPoints:function(O){var N=this;return C.map(O,function(P){return N._getGeoPoint(P)})},_isAnd:function(N){return N.operator===M.and},_and:function(S){var R,O,Q,N={};var P=S.operands;for(R=0,O=P.length;R<O;R++){Q=this._build(P[R]);N=this._andAppend(N,Q)}return N},_andAppend:function(R,O){var Q,N,P,T,U;var S=C.keys(O);for(Q=0,N=S.length;Q<N;Q++){P=S[Q];T=R[P];if(typeof T==="undefined"){R[P]=O[P]}else{U=O[P];if(typeof T==="object"&&typeof U==="object"){T=C.extend(T,U)}else{T=U}R[P]=T}}return R},_isOr:function(N){return N.operator===M.or},_or:function(S){var R,O,Q,N=[];var P=S.operands;for(R=0,O=P.length;R<O;R++){Q=this._build(P[R]);N.push(Q)}return{$or:N}},_isNot:function(N){return N.operator===M.not},_not:function(N){return{$not:this._build(N.operands[0])}},_translateoperator:function(N){switch(N){case M.equal:return null;case M.not_equal:return"$ne";case M.gt:return"$gt";case M.lt:return"$lt";case M.gte:return"$gte";case M.lte:return"$lte";case M.isin:return"$in";case M.notin:return"$nin";case M.all:return"$all";case M.size:return"$size"}throw new c("Unknown operator type.")}};t.Query=H;t.QueryBuilder=K}());var x=(function(){var R={filter:"X-Everlive-Filter",select:"X-Everlive-Fields",sort:"X-Everlive-Sort",skip:"X-Everlive-Skip",take:"X-Everlive-Take",expand:"X-Everlive-Expand"};var N=null;function H(T,U){a(T,"setup");a(U,"options");this.setup=T;this.method=null;this.endpoint=null;this.data=null;this.headers={};this.success=null;this.error=null;this.parse=H.parsers.simple;C.extend(this,U);this._init(U);N=this}H.prototype={send:function(){t.sendRequest(this)},buildAuthHeader:s,buildUrl:function P(T){return t.buildUrl(T)},buildQueryHeaders:function K(T){if(T){if(T instanceof t.Query){return H.prototype._buildQueryHeaders(T)}else{return H.prototype._buildFilterHeader(T)}}else{return{}}},_init:function(T){C.extend(this.headers,this.buildAuthHeader(this.setup,T),this.buildQueryHeaders(T.filter),T.headers)},_buildQueryHeaders:function(T){T=T.build();var U={};if(T.$where!==null){U[R.filter]=JSON.stringify(T.$where)}if(T.$select!==null){U[R.select]=JSON.stringify(T.$select)}if(T.$sort!==null){U[R.sort]=JSON.stringify(T.$sort)}if(T.$skip!==null){U[R.skip]=T.$skip}if(T.$take!==null){U[R.take]=T.$take}if(T.$expand!==null){U[R.expand]=JSON.stringify(T.$expand)}return U},_buildFilterHeader:function(T){var U={};U[R.filter]=JSON.stringify(T);return U}};t.Request=H;t.prototype.request=function(T){return new H(this.setup,T)};function S(X){if(N&&N.setup&&N.setup.parseOnlyCompleteDateTimeObjects){if(/^\d{4}-\d{2}-\d{2}$/.test(X)){return null}if(/^(\d{2}):(\d{2})(:(\d{2})(\.(\d+))?)?(Z|((\+|-)(\d{2}):(\d{2})))?$/.test(X)){return null}}var W;if(W=X.match(/^(\d{4})(-(\d{2})(-(\d{2})(T(\d{2}):(\d{2})(:(\d{2})(\.(\d+))?)?(Z|((\+|-)(\d{2}):(\d{2}))))?))$/)){var U=W[12];if(U){if(U.length>3){U=Math.round(Number(U.substr(0,3)+"."+U.substr(3)))}else{if(U.length<3){U+=U.length===2?"0":"00"}}}var V=new Date(Date.UTC(Number(W[1]),(Number(W[3])-1)||0,Number(W[5])||0,Number(W[7])||0,Number(W[8])||0,Number(W[10])||0,Number(U)||0));if(W[13]&&W[13]!=="Z"){var Y=Number(W[16])||0,T=Number(W[17])||0;Y*=3600000;T*=60000;var Z=Y+T;if(W[15]==="+"){Z=-Z}V=new Date(V.valueOf()+Z)}return V}else{return null}}function O(U,V){if(typeof V==="string"){var T=S(V);if(T){V=T}}return V}function L(X,U){var T,V,W;for(T in X){if(X.hasOwnProperty(T)){V=X[T];W=U(T,V);X[T]=W;if(V===W&&typeof V==="object"){L(V,U)}}}}function G(T){L(T,O)}t._traverseAndRevive=G;function I(T){if(typeof T==="string"&&T.length>0){T=JSON.parse(T,O)}else{if(typeof T==="object"){G(T)}}if(T){return{result:T.Result,count:T.Count}}else{return T}}function J(T){if(typeof T==="string"&&T.length>0){try{T=JSON.parse(T);return{message:T.message,code:T.errorCode}}catch(U){return T}}else{return T}}function Q(T){if(typeof T==="string"&&T.length>0){T=JSON.parse(T,O)}else{if(typeof T==="object"){G(T)}}if(T){return{result:T.Result}}else{return T}}function M(T){if(typeof T==="string"&&T.length>0){T=JSON.parse(T,O)}else{if(typeof T==="object"){G(T)}}if(T){return{result:T.Result,ModifiedAt:T.ModifiedAt}}else{return T}}H.parsers={simple:{result:I,error:J},single:{result:Q,error:J},update:{result:M,error:J}};t.disableRequestCache=function(T,W){if(W==="GET"){var U=(new Date()).getTime();var V=T.indexOf("?")>-1?"&":"?";T+=V+"_el="+U}return T};if(typeof t.sendRequest==="undefined"){t.sendRequest=function(U){var T=U.buildUrl(U.setup)+U.endpoint;T=t.disableRequestCache(T,U.method);var V=U.method==="GET"?U.data:JSON.stringify(U.data);m({url:T,method:U.method,data:V,headers:U.headers,type:"json",contentType:"application/json",crossOrigin:true,success:function(X,Y,W){U.success.call(U,U.parse.result(X))},error:function(W,Y,X){U.error.call(U,U.parse.error(W.responseText))}})}}return H}());t.getCallbacks=function(I,G){var H;if(typeof I!=="function"&&typeof G!=="function"){H=new k.Promise(function(K,J){I=function(L){K(L)};G=function(L){J(L)}})}return{promise:H,success:I,error:G}};function w(G,J,H){var I=t.getCallbacks(J,H);G(I.success,I.error);return I.promise}function B(G,H){return function(K,I){var J=K.result;if(C.isArray(G)||typeof G.length==="number"){C.each(G,function(M,L){C.extend(M,J[L])})}else{C.extend(G,J)}H(K,I)}}function l(G,H){return function(J){var I=J.ModifiedAt;G.ModifiedAt=I;H(J)}}function f(G,H){this.setup=G;this.collectionName=H;this.options=null}f.prototype={withHeaders:function(H){var G=this.options||{};G.headers=C.extend(G.headers||{},H);this.options=G;return this},expand:function(H){var G={"X-Everlive-Expand":JSON.stringify(H)};return this.withHeaders(G)},_createRequest:function(G){C.extend(G,this.options);this.options=null;return new x(this.setup,G)},get:function(I,J,H){var G=this;return w(function(M,K){var L=G._createRequest({method:"GET",endpoint:G.collectionName,filter:I,success:M,error:K});L.send()},J,H)},getById:function(J,I,H){var G=this;return w(function(M,K){var L=G._createRequest({method:"GET",endpoint:G.collectionName+"/"+J,parse:x.parsers.single,success:M,error:K});L.send()},I,H)},count:function(I,J,H){var G=this;return w(function(M,K){var L=G._createRequest({method:"GET",endpoint:G.collectionName+"/_count",filter:I,parse:x.parsers.single,success:M,error:K});L.send()},J,H)},create:function(I,J,H){var G=this;return w(function(M,K){var L=G._createRequest({method:"POST",endpoint:G.collectionName,data:I,parse:x.parsers.single,success:B(I,M),error:K});L.send()},J,H)},rawUpdate:function(I,J,K,H){var G=this;return w(function(P,M){var O=G.collectionName;var L=null;if(typeof J==="string"){O+="/"+J}else{if(typeof J==="object"){L=J}}var N=G._createRequest({method:"PUT",endpoint:O,data:I,filter:L,success:P,error:M});N.send()},K,H)},_update:function(I,K,M,J,L,H){var G=this;return w(function(S,N){var R=G.collectionName;var P=S;if(M){R+="/"+I[i];P=l(I,S)}var Q={};Q[J?"$replace":"$set"]=I;var O=G._createRequest({method:"PUT",endpoint:R,parse:x.parsers.update,data:Q,filter:K,success:P,error:N});O.send()},L,H)},updateSingle:function(H,I,G){return this._update(H,null,true,false,I,G)},update:function(H,I,J,G){return this._update(H,I,false,false,J,G)},_destroy:function(I,J,L,K,H){var G=this;return w(function(P,M){var O=G.collectionName;if(L){O+="/"+I[i]}var N=G._createRequest({method:"DELETE",endpoint:O,filter:J,success:P,error:M});N.send()},K,H)},destroySingle:function(H,I,G){return this._destroy(H,null,true,I,G)},destroy:function(H,I,G){return this._destroy(null,H,false,I,G)},setAcl:function(K,I,J,H){var G=this;return w(function(P,L){var O=G.collectionName;if(typeof I==="string"){O+="/"+I}else{if(typeof I==="object"){O+="/"+I[i]}}O+="/_acl";var Q,N;if(K===null){Q="DELETE"}else{Q="PUT";N=K}var M=G._createRequest({method:Q,endpoint:O,data:N,success:P,error:L});M.send()},J,H)},setOwner:function(G,J,K,I){var H=this;return w(function(O,L){var N=H.collectionName;if(typeof J==="string"){N+="/"+J}else{if(typeof J==="object"){N+="/"+J[i]}}N+="/_owner";var M=H._createRequest({method:"PUT",endpoint:N,data:{Owner:G},success:O,error:L});M.send()},K,I)},save:function(J,K,I){var H=this;var G=this.isNew(J);return w(function(O,L){function N(P){P.type=G?"create":"update";O(P)}function M(P){P.type=G?"create":"update";L(P)}if(G){return H.create(J,N,M)}else{return H.updateSingle(J,N,M)}},K,I)},isNew:function(G){return typeof G[i]==="undefined"}};t.Data=f;function n(G,H){this.longitude=G||0;this.latitude=H||0}t.GeoPoint=n;var g={unauthenticated:"unauthenticated",masterKey:"masterKey",invalidAuthentication:"invalidAuthentication",authenticated:"authenticated"};t.AuthStatus=g;function j(G,J,L,I){if(G.masterKey){return w(function(N,M){N({status:g.masterKey})},L,I)}if(!G.token){return w(function(N,M){N({status:g.unauthenticated})},L,I)}var H;if(L){H=function(M){if(M&&M.code===601){L({status:g.invalidAuthentication})}else{I(M)}}}var K=J(L,H);if(K){K=K.then(function(M){return{status:g.authenticated,user:M.result}},function(M){if(M&&M.code===601){return{status:g.invalidAuthentication}}else{throw M}})}return K}t.prototype.authInfo=function(H,G){return j(this.setup,C.bind(this.Users.getById,this.Users,"me"),H,G)};var d=function(G){G._loginSuccess=function(J){var I=J.result;var H=this.setup;H.token=I.access_token;H.tokenType=I.token_type};G._logoutSuccess=function(){var H=this.setup;H.token=null;H.tokenType=null};G.register=function(M,K,J,L,I){a(M,"username");a(K,"password");var H={Username:M,Password:K};C.extend(H,J);return this.create(H,L,I)};G.login=function(L,J,K,I){var H=this;return w(function(O,M){var N=new x(H.setup,{method:"POST",endpoint:"oauth/token",data:{username:L,password:J,grant_type:"password"},authHeaders:false,parse:x.parsers.single,success:function(){H._loginSuccess.apply(H,arguments);O.apply(null,arguments)},error:M});N.send()},K,I)};G.currentUser=function(J,I){var H=this;return w(function(L,K){j(H.setup,C.bind(H.getById,H,"me")).then(function(M){if(typeof M.user!=="undefined"){L({result:M.user})}else{L({result:null})}},function(M){K(M)})},J,I)};G.changePassword=function(N,J,M,K,L,I){var H=this;return w(function(R,O){var Q="Users/changepassword";if(K){Q+="?keepTokens=true"}var P=new x(H.setup,{method:"POST",endpoint:Q,data:{Username:N,Password:J,NewPassword:M},authHeaders:false,parse:x.parsers.single,success:R,error:O});P.send()},L,I)};G.logout=function(J,I){var H=this;return w(function(M,K){var L=new x(H.setup,{method:"GET",endpoint:"oauth/logout",success:function(){H._logoutSuccess.apply(H,arguments);M.apply(null,arguments)},error:K});L.send()},J,I)};G._loginWithProvider=function(J,L,K){var I={Identity:J};var H=this;return w(function(O,M){var N=new x(H.setup,{method:"POST",endpoint:"Users",data:I,authHeaders:false,parse:x.parsers.single,success:function(){H._loginSuccess.apply(H,arguments);O.apply(null,arguments)},error:M});N.send()},L,K)};G._linkWithProvider=function(I,K,L,J){var H=this;return w(function(O,M){var N=new x(H.setup,{method:"POST",endpoint:"Users/"+K+"/link",data:I,parse:x.parsers.single,success:O,error:M});N.send()},L,J)};G._unlinkFromProvider=function(L,K,M,J){var I={Provider:L};var H=this;return w(function(P,N){var O=new x(H.setup,{method:"POST",endpoint:"Users/"+K+"/unlink",data:I,parse:x.parsers.single,success:P,error:N});O.send()},M,J)};G.loginWithFacebook=function(J,K,I){var H={Provider:"Facebook",Token:J};return G._loginWithProvider(H,K,I)};G.linkWithFacebook=function(K,J,L,I){var H={Provider:"Facebook",Token:J};return G._linkWithProvider(H,K,L,I)};G.unlinkFromFacebook=function(I,J,H){return G._unlinkFromProvider("Facebook",I,J,H)};G.loginWithADFS=function(J,K,I){var H={Provider:"ADFS",Token:J};return G._loginWithProvider(H,K,I)};G.linkWithADFS=function(K,J,L,I){var H={Provider:"ADFS",Token:J};return G._linkWithProvider(H,K,L,I)};G.unlinkFromADFS=function(I,J,H){return G._unlinkFromProvider("ADFS",I,J,H)};G.loginWithLiveID=function(J,K,I){var H={Provider:"LiveID",Token:J};return G._loginWithProvider(H,K,I)};G.linkWithLiveID=function(K,J,L,I){var H={Provider:"LiveID",Token:J};return G._linkWithProvider(H,K,L,I)};G.unlinkFromLiveID=function(I,J,H){return G._unlinkFromProvider("LiveID",I,J,H)};G.loginWithGoogle=function(J,K,I){var H={Provider:"Google",Token:J};return G._loginWithProvider(H,K,I)};G.linkWithGoogle=function(K,J,L,I){var H={Provider:"Google",Token:J};return G._linkWithProvider(H,K,L,I)};G.unlinkFromGoogle=function(I,J,H){return G._unlinkFromProvider("Google",I,J,H)};G.loginWithTwitter=function(J,K,L,I){var H={Provider:"Twitter",Token:J,TokenSecret:K};return G._loginWithProvider(H,L,I)};G.linkWithTwitter=function(K,J,L,M,I){var H={Provider:"Twitter",Token:J,TokenSecret:L};return G._linkWithProvider(H,K,M,I)};G.unlinkFromTwitter=function(I,J,H){return G._unlinkFromProvider("Twitter",I,J,H)}};var p=function(G){G.getUploadUrl=function(){return t.buildUrl(this.setup)+this.collectionName};G.getDownloadUrl=function(H){return t.buildUrl(this.setup)+this.collectionName+"/"+H+"/Download"};G._getUpdateUrl=function(H){return this.collectionName+"/"+H+"/Content"};G.getUpdateUrl=function(H){return t.buildUrl(this.setup)+this._getUpdateUrl(H)};G.updateContent=function(H,K,L,J){var I=this;return w(function(P,M){var O=I._getUpdateUrl(H);var N=I._createRequest({method:"PUT",endpoint:O,data:K,success:P,error:M});N.send()},L,J)};G.getDownloadUrlById=function(H,K,J){var I=this;return w(function(N,L){var M=I._createRequest({method:"GET",endpoint:I.collectionName+"/"+H,parse:x.parsers.single,success:function(O){N(O.result.Uri)},error:L});M.send()},K,J)}};var E={WindowsPhone:1,Windows:2,Android:3,iOS:4,OSX:5,Blackberry:6,Nokia:7,Unknown:100};t.PushCallbacks={};var o=function(G){this._el=G;this.notifications=G.data("Push/Notifications");this.devices=G.data("Push/Devices")};o.prototype={currentDevice:function(G){if(arguments.length===0){G=this._el.setup._emulatorMode}if(!window.cordova){throw new c("Error: currentDevice() can only be called from within a hybrid mobile app, after 'deviceready' event has been fired.")}if(!this._currentDevice){this._currentDevice=new b(this)}this._currentDevice.emulatorMode=G;return this._currentDevice},register:function(J,L,H){var I=this.currentDevice();if(J&&J.android){J.android.senderID=J.android.projectNumber||J.android.senderID}var G=function(M,N){return function(){var O=new e(M);N(O)}};var K=function(N,O){var M=D.fromEverliveError(N);O(M)};return w(function(N,M){I.enableNotifications(J,function(P){var Q=P.token;var O=J?J.customParameters:undefined;I.getRegistration().then(function(){I.updateRegistration(O,G(Q,N),function(R){K(R,M)})},function(R){if(R.code===801){I.register(O,G(Q,N),M)}else{K(R,M)}})},function(P){var O=D.fromPluginError(P);M(O)})},L,H)},unregister:function(I,H){var G=this.currentDevice();return G.disableNotifications.apply(G,arguments)},updateRegistration:function(G,J,I){var H=this.currentDevice();return H.updateRegistration.apply(H,arguments)},getRegistration:function(I,H){var G=this.currentDevice();return G.getRegistration.apply(G,arguments)},send:function(H,I,G){return this.notifications.create.apply(this.notifications,arguments)}};var q={iOS:{badge:true,sound:true,alert:true},android:{senderID:null},notificationCallbackAndroid:null,notificationCallbackIOS:null};var b=function(G){this._pushHandler=G;this._initSuccessCallback=null;this._initErrorCallback=null;this._globalFunctionSuffix=null;this.pushSettings=null;this.pushToken=null;this.isInitialized=false;this.isInitializing=false;this.emulatorMode=false};b.prototype={enableNotifications:function(G,I,H){this.pushSettings=G;return w(C.bind(this._initialize,this),I,H)},disableNotifications:function(I,H){var G=this;return this.unregister().then(function(){return w(function(N,L){if(G.emulatorMode){N()}else{var J=window.plugins.pushNotification;var M;var K=G._getPlatformType(device.platform);if(K===E.WindowsPhone){M={channelName:G.pushSettings.wp8.channelName}}J.unregister(function(){G.isInitialized=false;N()},L,M)}},I,H)},H)},getRegistration:function(I,G){var H=this._getDeviceId();return this._pushHandler.devices.getById("HardwareId/"+H,I,G)},register:function(H,K,I){var G=this;var J={};if(H!==undefined){J.Parameters=H}return this._populateRegistrationObject(J).then(function(){return G._pushHandler.devices.create(J,K,I)},I)},unregister:function(I,G){var H=device.uuid;return this._pushHandler.devices.destroySingle({Id:"HardwareId/"+H},I,G)},updateRegistration:function(H,K,I){var G=this;var J={};if(H){J.Parameters=H}return this._populateRegistrationObject(J).then(function(){J.Id="HardwareId/"+J.HardwareId;return G._pushHandler.devices.updateSingle(J,K,I)},I)},_initialize:function(R,P){var T=this;if(this.isInitializing){P(new c("Push notifications are currently initializing."));return}if(!this.emulatorMode&&(!window.navigator||!window.navigator.globalization)){P(new c("The globalization plugin is not initialized."));return}if(!this.emulatorMode&&(!window.plugins||!window.plugins.pushNotification)){P(new c("The push notifications plugin is not initialized."));return}this._initSuccessCallback=R;this._initErrorCallback=P;if(this.isInitialized){this._deviceRegistrationSuccess(this.pushToken);return}if(this.emulatorMode){setTimeout(function(){T._deviceRegistrationSuccess("fake_push_token")},1000);return}this.isInitializing=true;var S=this._globalFunctionSuffix;if(!S){S=Date.now().toString();this._globalFunctionSuffix=S}var H=window.plugins.pushNotification;var K=this._getPlatformType(device.platform);if(K===E.iOS){var M="apnCallback_"+S;t.PushCallbacks[M]=C.bind(this._onNotificationAPN,this);var O=this.pushSettings.iOS;this._validateIOSSettings(O);O.ecb="Everlive.PushCallbacks."+M;H.register(C.bind(this._successfulRegistrationAPN,this),C.bind(this._failedRegistrationAPN,this),O)}else{if(K===E.Android){var G="gcmCallback_"+S;t.PushCallbacks[G]=C.bind(this._onNotificationGCM,this);var J=this.pushSettings.android;this._validateAndroidSettings(J);J.ecb="Everlive.PushCallbacks."+G;H.register(C.bind(this._successSentRegistrationGCM,this),C.bind(this._errorSentRegistrationGCM,this),J)}else{if(K===E.WindowsPhone){var L="wp8Callback_"+S;var Q="wp8RegistrationSuccessCallback_"+S;var I="wp8RegistrationErrorCallback_"+S;t.PushCallbacks[L]=C.bind(this._onNotificationWP8,this);t.PushCallbacks[Q]=C.bind(this._deviceRegistrationSuccessWP,this);t.PushCallbacks[I]=C.bind(this._deviceRegistrationFailed,this);var N=this.pushSettings.wp8;this._validateWP8Settings(N);N.ecb="Everlive.PushCallbacks."+L;N.uccb="Everlive.PushCallbacks."+Q;N.errcb="Everlive.PushCallbacks."+I;H.register(C.bind(this._successSentRegistrationWP8,this),C.bind(this._errorSentRegistrationWP8,this),N)}else{throw new c("The current platform is not supported: "+device.platform)}}}},_deviceRegistrationSuccessWP:function(G){this._deviceRegistrationSuccess(G.uri)},_validateAndroidSettings:function(G){if(!G.senderID){throw new c("Sender ID (project number) is not set in the android settings.")}},_validateWP8Settings:function(G){if(!G.channelName){throw new c("channelName is not set in the WP8 settings.")}},_validateIOSSettings:function(G){},_populateRegistrationObject:function(I,J,H){var G=this;return w(function(L,K){if(!G.pushToken){throw new c("Push token is not available.")}G._getLocaleName(function(M){var S=G._getDeviceId();var Q=device.name;var O=G._getPlatformType(device.platform);var P=h.determine().name();var N=G.pushToken;var T=M.value;var R=device.version;I.HardwareId=S;I.HardwareModel=Q;I.PlatformType=O;I.PlatformVersion=R;I.TimeZone=P;I.PushToken=N;I.Locale=T;L()},K)},J,H)},_getLocaleName:function(H,G){if(this.emulatorMode){H({value:"en_US"})}else{navigator.globalization.getLocaleName(function(I){H(I)},G);navigator.globalization.getLocaleName(function(I){},G)}},_getDeviceId:function(){return device.uuid},_getPlatformType:function(H){var G=H.toLowerCase();switch(G){case"ios":case"iphone":case"ipad":return E.iOS;case"android":return E.Android;case"wince":return E.WindowsPhone;case"win32nt":return E.WindowsPhone;default:return E.Unknown}},_deviceRegistrationFailed:function(G){this.pushToken=null;this.isInitializing=false;this.isInitialized=false;if(this._initErrorCallback){this._initErrorCallback({error:G})}},_deviceRegistrationSuccess:function(G){this.pushToken=G;this.isInitializing=false;this.isInitialized=true;if(this._initSuccessCallback){this._initSuccessCallback({token:G})}},_successfulRegistrationAPN:function(G){this._deviceRegistrationSuccess(G)},_failedRegistrationAPN:function(G){this._deviceRegistrationFailed(G)},_successSentRegistrationGCM:function(G){},_successSentRegistrationWP8:function(G){},_errorSentRegistrationWP8:function(G){this._deviceRegistrationFailed(G)},_errorSentRegistrationGCM:function(G){this._deviceRegistrationFailed(G)},_onNotificationAPN:function(G){this._raiseNotificationEventIOS(G)},_onNotificationWP8:function(G){this._raiseNotificationEventWP8(G)},_onNotificationGCM:function z(G){switch(G.event){case"registered":if(G.regid.length>0){this._deviceRegistrationSuccess(G.regid)}break;case"message":this._raiseNotificationEventAndroid(G);break;case"error":if(!this.pushToken){this._deviceRegistrationFailed(G)}else{this._raiseNotificationEventAndroid(G)}break;default:this._raiseNotificationEventAndroid(G);break}},_raiseNotificationEventAndroid:function(G){if(this.pushSettings.notificationCallbackAndroid){this.pushSettings.notificationCallbackAndroid(G)}},_raiseNotificationEventIOS:function(G){if(this.pushSettings.notificationCallbackIOS){this.pushSettings.notificationCallbackIOS(G)}},_raiseNotificationEventWP8:function(G){if(this.pushSettings.notificationCallbackWP8){this.pushSettings.notificationCallbackWP8(G)}}};function c(){var G=Error.apply(this,arguments);G.name=this.name="EverliveError";this.message=G.message;Object.defineProperty(this,"stack",{get:function(){return G.stack}});return this}c.prototype=Object.create(Error.prototype);c.prototype.toJSON=function(){return{name:this.name,message:this.message,stack:this.stack}};var D=function(I,H,G){c.call(this,H);this.errorType=I;this.message=H;if(G!==undefined){this.additionalInformation=G}};D.prototype=Object.create(c.prototype);D.fromEverliveError=function(H){var G=new D(v.EverliveError,H.message,H);return G};D.fromPluginError=function(H){var I="A plugin error occurred";if(H){if(typeof H.error==="string"){I=H.error}else{if(typeof H.message==="string"){I=H.message}}}var G=new D(v.PluginError,I,H);return G};var v={EverliveError:1,PluginError:2};var e=function(G){this.token=G};var A=function(){this.Users=this.data("Users");d(this.Users);this.Files=this.data("Files");p(this.Files);this.push=new o(this)};u.push({name:"default",func:A});return t}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["Everlive"],function(c){b(c)})}else{b(a.Everlive)}}(this,function(n){var h=window.jQuery,j=window.kendo;if(h===undefined||j===undefined){return}var i=h.extend;i(true,j.data,{schemas:{everlive:{type:"json",data:function(o){if(typeof o.ModifiedAt!=="undefined"){return{ModifiedAt:o.ModifiedAt}}else{return o.Result||o}},total:"Count",model:{id:"Id"}}},transports:{everlive:{read:{dataType:"json",type:"GET",cache:false},update:{dataType:"json",contentType:"application/json",type:"PUT",cache:false},create:{dataType:"json",contentType:"application/json",type:"POST",cache:false},destroy:{dataType:"json",type:"DELETE",cache:false},parameterMap:function(p,o){if(o==="destroy"){return{}}if(o==="create"||o==="update"){return JSON.stringify(p)}if(o==="read"){return null}}}}});function l(s){var o={};if(s){if(s.skip){o.$skip=s.skip;delete s.skip}if(s.take){o.$take=s.take;delete s.take}if(s.sort){var r=s.sort;var p={};if(!h.isArray(r)){r=[r]}h.each(r,function(t,u){p[u.field]=u.dir==="asc"?1:-1});o.$sort=p;delete s.sort}if(s.filter){var q=new k().build(s.filter);o.$where=q;delete s.filter}}return o}var m=["startswith","startsWith","endswith","endsWith","contains"];function k(){}k.prototype={build:function(o){return this._build(o)},_build:function(o){if(this._isRaw(o)){return this._raw(o)}else{if(this._isSimple(o)){return this._simple(o)}else{if(this._isRegex(o)){return this._regex(o)}else{if(this._isAnd(o)){return this._and(o)}else{if(this._isOr(o)){return this._or(o)}}}}}},_isRaw:function(o){return o.operator==="_raw"},_raw:function(p){var o={};o[p.field]=p.value;return o},_isSimple:function(o){return typeof o.logic==="undefined"&&!this._isRegex(o)},_simple:function(r){var q={},o={};var p=this._translateoperator(r.operator);if(p){q[p]=r.value}else{q=r.value}o[r.field]=q;return o},_isRegex:function(o){return h.inArray(o.operator,m)!==-1},_regex:function(q){var o={};var r=this._getRegex(q);var p=this._getRegexValue(r);o[q.field]=p;return o},_getRegex:function(p){var q=p.value;var o=p.operator;switch(o){case"contains":return new RegExp(".*"+q+".*","i");case"startsWith":case"startswith":return new RegExp("^"+q,"i");case"endsWith":case"endswith":return new RegExp(q+"$","i")}throw new Error("Unknown operator type.")},_getRegexValue:function(o){return n.QueryBuilder.prototype._getRegexValue.call(this,o)},_isAnd:function(o){return o.logic==="and"},_and:function(t){var s,p,r,o={};var q=t.filters;for(s=0,p=q.length;s<p;s++){r=this._build(q[s]);o=this._andAppend(o,r)}return o},_andAppend:function(p,o){return n.QueryBuilder.prototype._andAppend.call(this,p,o)},_isOr:function(o){return o.logic==="or"},_or:function(t){var s,p,r,o=[];var q=t.filters;for(s=0,p=q.length;s<p;s++){r=this._build(q[s]);o.push(r)}return{$or:o}},_translateoperator:function(o){switch(o){case"eq":return null;case"neq":return"$ne";case"gt":return"$gt";case"lt":return"$lt";case"gte":return"$gte";case"lte":return"$lte"}throw new Error("Unknown operator type.")}};function b(o){return new n.Query(o.$where,null,o.$sort,o.$skip,o.$take)}var g=j.data.RemoteTransport.prototype.setup;j.data.RemoteTransport.prototype.setup=function(p,q){if(!p.url&&!this.options[q].url&&this.options.typeName){if(!n.$){throw new Error("You should either specify a url for this transport method, or instantiate an Everlive instance.")}p.url=n.Request.prototype.buildUrl(n.$.setup)+this.options.typeName;if(q==="update"||q==="destroy"){p.url+="/"+p.data[n.idField]}}if(n.$){p.headers=n.Request.prototype.buildAuthHeader(n.$.setup)}if(q==="read"&&p.data){var r=l(p.data);var o=b(r);p.headers=h.extend(p.headers,n.Request.prototype.buildQueryHeaders(o))}if(q==="create"||q==="read"||q==="update"){var s=p.success;p.success=function(t){n._traverseAndRevive(t);if(s){s(t)}}}return g.call(this,p,q)};var d=[n.idField,"CreatedAt"];var c=j.data.Model.prototype.accept;j.data.Model.prototype.accept=function(q){var o=this,r,p;n._traverseAndRevive(q);if(q&&o.isNew()&&q[n.idField]){for(r in o.fields){if(h.inArray(r,d)===-1){p=o.get(r);q[r]=p}}}else{if(q&&typeof q.ModifiedAt!=="undefined"){for(r in o.fields){if(r!=="ModifiedAt"){p=o.get(r);q[r]=p}}}}c.call(this,q)};var e=function(p,t){var r=f(t[t.length-1]);var q=t.slice(0,t.length-1);var s="/_expand";for(var o=0;o<q.length;o++){s+="/"+f(q[o])}return(function(v,u){return function(x){var w=p+"";if(x.Id&&u){w+=v+"/"+x.Id+"/"+u}return w}}(s,r))};var a=function(o){if(typeof o==="string"){return{}}else{return{"X-Everlive-Filter":JSON.stringify(o.filter),"X-Everlive-Sort":JSON.stringify(o.sort),"X-Everlive-Single-Field":o.singleField,"X-Everlive-Skip":o.skip,"X-Everlive-Take":o.take,"X-Everlive-Fields":JSON.stringify(o.fields)}}};var f=function(o){if(typeof o==="string"){return o}else{if(o.relation){return o.relation}else{throw new Error("You need to specify a 'relation' for an expand node when using the object notation")}}};n.createHierarchicalDataSource=function(p){p=p||{};var r=p.expand;var o=p.typeName;delete p.expand;delete p.typeName;var s;if(p.url){s=p.url}else{if(n.$&&o){s=n.Request.prototype.buildUrl(n.$.setup)+o}else{if(!n.$){throw new Error("You need to instantiate an Everlive instance in order to create a kendo HierarchicalDataSource.")}if(!o){throw new Error("You need to specify a 'typeName' in order to create a kendo HierarchicalDataSource.")}}}var u;if(r){for(var q=r.length-1;q>=0;q--){var u={model:{hasChildren:f(r[q]),children:{type:"everlive",transport:{read:{url:e(s,r.slice(0,q+1)),headers:a(r[q])}},schema:u}}}}}var t={};t.type="everlive";t.transport={typeName:o},t.schema=u;i(true,t,p);return new j.data.HierarchicalDataSource(t)};n.createDataSource=function(p){p=p||{};var o=p.typeName;if(!o){throw new Error("You need to specify a 'typeName' in order to create a kendo DataSource.")}delete p.typeName;var q={};q.type="everlive";q.transport={typeName:o},i(true,q,p);return new j.data.DataSource(q)}}));